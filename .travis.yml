branches:
  only:
    - master

cache:
  directories:
    - $HOME/.portage-pkgdir

matrix:
  include:
    - language: python
      python: 2.7
    - language: python
      python: 3.4

install:
  - travis_wait 20 pip install -r requirements.txt
  - pip install .

script:
  - pytest
  - export MPLBACKEND="agg"
  - cd samri/examples
  - for f in *.py ; do python "$f" ; done

- os: linux
  services: docker
  language: generic
  sudo: required
  script:
    - 'if [ "${TRAVIS_EVENT_TYPE}" != "cron" ]; then
      docker run --rm -ti -v "${HOME}"/.portage-pkgdir:/usr/portage/packages -v "${PWD}":${HOME}/SAMRI -w ${HOME}/SAMRI buffepva/gentoo ${HOME}/SAMRI/.gentoo/on_travis.sh; fi'
